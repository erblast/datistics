---
title: simaerep release 0.6.0
author: Björn Koneswarakantha
date: '2024-09-30'
slug: simaerep-v0.6.0
categories:
  - R
tags:
  - R
  - bootstrap
  - clinical studies
summary: Detect Under- and Over- Reporting of Clinical Events in Clinical Trials with simaerep 0.6.0
thumbnailImagePosition : left
thumbnailImage: simaerep_logo_square.png
editor_options: 
  chunk_output_type: console
output:
  blogdown::html_page:
    toc: false
---



<p><br></br>
<br></br></p>
<p>Simulate patient-related events in clinical trials with the goal of detecting over and under-reporting sites.</p>
<p>Monitoring reporting rates of patient-related events such as adverse events (AE) in clinical trials is important for patient safety. We use bootstrap-based simulation to assign over- and under-reporting probabilities to each site in a clinical trial. The method is inspired by the ‘infer’ R package and Allen Downey’s blog article: <a href="http://allendowney.blogspot.com/2011/05/there-is-only-one-test.html">“There is only one test!”</a>.</p>
{{% image classes="center" src="https://github.com/openpharma/simaerep/raw/master/man/figures/logo.png" thumbnail="https://github.com/openpharma/simaerep/raw/master/man/figures/logo.png" thumbnail-width="360px" thumbnail-height="360px" target="https://openpharma.github.io/simaerep/" %}}
<p><br></br>
<br></br></p>
<div id="key-risk-indicators" class="section level1">
<h1>Key Risk Indicators</h1>
<p>Statistical monitoring of clinical trial sites typical employs several key risk indicators which are operational metrics derived from activities at the clinical trial sites. The ratio
of AEs is typically one of them, the ratio of issues occurring when treating and examininig patients according to the study protocol might be another one.</p>
</div>
<div id="release-0.6.0" class="section level1">
<h1>Release 0.6.0</h1>
<div id="updated-algorithm" class="section level2">
<h2>Updated Algorithm</h2>
<p>The default {simaerep} default algorithm picks for each site a specific evaluation point called visit_med75 based
on the individual progression of the majority of the patients at a given site. Based on this site-level metric patients from the study pool would be sampled. With the most current release <code>v0.6.0</code> an alternative algorithm which identifies matches on patient-level for bootstrapping has been added. This algorithm has been coded with <code>dbplyr</code> compatible table operations and can be executed within a database-backend. More details about the so called <strong>inframe</strong> method can be found in the <a href="https://openpharma.github.io/simaerep/articles/inframe.html">documentation</a>.</p>
</div>
<div id="increased-statistical-performance" class="section level2">
<h2>Increased Statistical Performance</h2>
<p>The latest statistical <a href="">performance benchmark</a> shows that the <strong>inframe</strong> method with disabled visit_med75 increases the overall statistical performance of {simaerep}. We can further show that the previously implemented multiplicity correction actually decreases performance of {simaerep}. This observation was already previously made during the validataion of {siamerep} by one of the IMPALA member companies. <code>simaerep()</code> has received a new parameter <code>mult_corr</code> to conveniently disable the multiplicity correction.</p>
</div>
<div id="demo" class="section level2">
<h2>Demo</h2>
<div id="new-recommendation" class="section level3">
<h3>New Recommendation</h3>
<p>Recommended Threshold: <code>aerep$dfeval$prob_low_prob_ur: 0.99</code></p>
<pre class="r"><code>suppressPackageStartupMessages(library(simaerep))
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(knitr))

set.seed(1)

df_visit &lt;- simaerep::sim_test_data_study(
  n_pat = 1000, # number of patients in study
  n_sites = 100, # number of sites in study
  frac_site_with_ur = 0.05, # fraction of sites under-reporting
  ur_rate = 0.4, # rate of under-reporting
  ae_per_visit_mean = 0.5 # mean AE per patient visit
)

df_visit$study_id &lt;- &quot;A&quot;

df_visit %&gt;%
  select(study_id, site_number, patnum, visit, n_ae) %&gt;%
  head(10) %&gt;%
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">study_id</th>
<th align="left">site_number</th>
<th align="left">patnum</th>
<th align="right">visit</th>
<th align="right">n_ae</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">4</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">5</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">6</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">7</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">8</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">9</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">A</td>
<td align="left">S0001</td>
<td align="left">P000001</td>
<td align="right">10</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
<pre class="r"><code>aerep &lt;- simaerep::simaerep(
  df_visit,
  inframe = TRUE,
  visit_med75 = FALSE,
  mult_corr = FALSE
  )


plot(aerep, study = &quot;A&quot;)</code></pre>
<p><img src="/post/2024-09-30-simaerep_files/figure-html/unnamed-chunk-2-1.png" width="960" /></p>
</div>
<div id="in-database-calculation" class="section level3">
<h3>In Database Calculation</h3>
<p>We demo in database calculations with <code>duckdb</code>.</p>
<p>We need to provide a in database table that has as many rows as the desired replications in our simulation, instead of providing an integer for the <code>r</code> parameter.</p>
<pre class="r"><code>con &lt;- DBI::dbConnect(duckdb::duckdb(), dbdir = &quot;:memory:&quot;)
df_r &lt;- tibble(rep = seq(1, 1000))

dplyr::copy_to(con, df_visit, &quot;visit&quot;)
dplyr::copy_to(con, df_r, &quot;r&quot;)

tbl_visit &lt;- tbl(con, &quot;visit&quot;)
tbl_r &lt;- tbl(con, &quot;r&quot;)


aerep &lt;- simaerep(
  tbl_visit,
  r = tbl_r,
  inframe = TRUE,
  visit_med75 = FALSE,
  mult_corr = FALSE
)

plot(aerep, df_visit = tbl_visit)</code></pre>
<pre><code>## study = NULL, defaulting to study:A</code></pre>
<p><img src="/post/2024-09-30-simaerep_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>DBI::dbDisconnect(con)</code></pre>
</div>
</div>
</div>
<div id="upcoming-breaking-changes" class="section level1">
<h1>Upcoming Breaking Changes</h1>
<p>In the upcoming release the default settings of <code>siamerep</code> will be changed to the new recommendations and we will remove the AE wording from the package and change input and output column names.</p>
</div>
<div id="impala" class="section level1">
<h1>IMPALA</h1>
<p><code>simaerep</code> has been published as workproduct of the Inter-Company Quality Analytics (<a href="https://impala-consortium.org/">IMPALA</a>) consortium. IMPALA aims to engage with Health Authorities inspectors on
defining guiding principles for the use of advanced analytics to complement, enhance and accelerate current QA practices. <code>simaerep</code> has initially been developed at Roche but is currently evaluated by
other companies across the industry to complement their quality assurance activities (<a href="https://impala-consortium.org/clinical-safety-reporting-work-product-stream/">see testimonials</a>).</p>
<p><a href="https://impala-consortium.org/"><img src="https://impala-consortium.org/wp-content/uploads/IMPALA-logo-x2.png" alt="IMPALA logo" /></a></p>
</div>
<div id="ressources" class="section level1">
<h1>Ressources</h1>
<ul>
<li><a href="https://github.com/openpharma/simaerep/">github</a></li>
<li><a href="https://openpharma.github.io/simaerep/index.html">website</a></li>
</ul>
</div>
<div id="publications" class="section level1">
<h1>Publications</h1>
<p>Koneswarakantha, B., Adyanthaya, R., Emerson, J. et al. An Open-Source R Package for Detection of Adverse Events Under-Reporting in Clinical Trials: Implementation and Validation by the IMPALA
(Inter coMPany quALity Analytics) Consortium. Ther Innov Regul Sci (2024). <a href="https://doi.org/10.1007/s43441-024-00631-8" class="uri">https://doi.org/10.1007/s43441-024-00631-8</a></p>
<p>Koneswarakantha, B., Barmaz, Y., Ménard, T. et al. <em>Follow-up on the Use of Advanced Analytics for Clinical Quality Assurance: Bootstrap Resampling to Enhance Detection of Adverse Event Under-Reporting.</em> Drug
Saf (2020).<br />
<a href="https://doi.org/10.1007/s40264-020-01011-5" class="uri">https://doi.org/10.1007/s40264-020-01011-5</a></p>
</div>
